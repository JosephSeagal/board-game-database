<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Board Game Search</title>
    <link rel="stylesheet" type="text/css" href="css/navbar.css">
</head>
<body>
    <nav class="navbar">
        <ul class="navbar-menu">
			<li><a href="index.html" class="navbar-item">Search Games</a></li>
			<li><a href="simplesearch.html" class="navbar-item">Search Users/Groups</a></li>
			<li><a href="usermanagement.html" class="navbar-item">Manage Users</a></li>
			<li><a href="groupmanagement.html" class="navbar-item">Manage Groups</a></li>
        </ul>
    </nav>

    <h1>Board Game Search</h1>

    <h2>Search for board games</h2>

    <div class="form">
        <div>
            <label for="keyword">Keyword:</label>
            <input id="keyword" type="text" placeholder="Enter title or description">
        </div>
        <button id="searchButton">Search for Board Games</button>
    </div>

    <div class="form">
        <div>
            <label for="username">Username:</label>
            <input id="username" type="text" placeholder="Enter username">
        </div>
        <button id="userSearchButton">Find Games by Preferred Genres</button>
    </div>

    <h3>Filter Board Games</h3>

    <div class="form">
        <div>
            <label for="filterMinPlayers">Min Players:</label>
            <input id="filterMinPlayers" type="number" placeholder="e.g., 2">
        </div>

        <div>
            <label for="filterMaxPlayers">Max Players:</label>
            <input id="filterMaxPlayers" type="number" placeholder="e.g., 5">
        </div>

        <div>
            <label for="filterRating">Minimum Rating:</label>
            <input id="filterRating" type="number" step="0.01" placeholder="e.g., 7.5">
        </div>

        <div>
            <label for="filterPrice">Maximum Price:</label>
            <input id="filterPrice" type="number" step="0.01" placeholder="e.g., 60">
        </div>

        <button id="filterSearchButton">Search with Filters</button>
    </div>

    <div id="boardgameMessage"></div>

    <table>
        <thead>
            <tr>
                <th>ID</th><th>Title</th><th>Description</th>
                <th>Min Players</th><th>Max Players</th>
                <th>Avg Rating</th><th>Price</th><th>URL</th>
            </tr>
        </thead>
        <tbody id="boardgames"></tbody>
    </table>

    <script>
        function fetchAndDisplayGames(url) {
            let table = document.getElementById("boardgames");
            let message = document.getElementById("boardgameMessage");

            table.textContent = "";
            message.textContent = "";

            fetch(url)
                .then((response) => response.json())
                .then((body) => {
                    if (!body.rows || body.rows.length === 0) {
                        message.textContent = "No matching board games found.";
                        return;
                    }

                    for (let item of body.rows) {
                        let row = document.createElement("tr");
                        for (let key of Object.keys(item)) {
                            let col = document.createElement("td");
                            col.textContent = item[key];
                            row.appendChild(col);
                        }
                        table.appendChild(row);
                    }
                })
                .catch((error) => {
                    console.error(error);
                    message.textContent = "Error fetching board games.";
                });
        }

        document.getElementById("searchButton").addEventListener("click", () => {
            let keyword = document.getElementById("keyword").value.trim();
            let url = "/search/games?q=" + encodeURIComponent(keyword);
            fetchAndDisplayGames(url);
        });

        document.getElementById("userSearchButton").addEventListener("click", () => {
            let username = document.getElementById("username").value.trim();
            let url = "/search/games/by-user?username=" + encodeURIComponent(username);
            fetchAndDisplayGames(url);
        });

        document.getElementById("filterSearchButton").addEventListener("click", () => {
            let params = new URLSearchParams();

            let minP = document.getElementById("filterMinPlayers").value.trim();
            let maxP = document.getElementById("filterMaxPlayers").value.trim();
            let rating = document.getElementById("filterRating").value.trim();
            let price = document.getElementById("filterPrice").value.trim();

            if (minP) params.append("min_players", minP);
            if (maxP) params.append("max_players", maxP);
            if (rating) params.append("min_rating", rating);
            if (price) params.append("max_price", price);

            let url = "/search/games/filters?" + params.toString();
            fetchAndDisplayGames(url);
        });

    </script>

</body>
</html>
