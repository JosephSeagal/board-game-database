<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>SimpleSearch</title>
	<link rel="stylesheet" type="text/css" href="css/navbar.css">
</head>
<body>
    <nav class="navbar">
        <ul class="navbar-menu">
			<li><a href="index.html" class="navbar-item">Search Games</a></li>
			<li><a href="simplesearch.html" class="navbar-item">Search Users/Groups</a></li>
			<li><a href="usermanagement.html" class="navbar-item">Manage Users</a></li>
			<li><a href="groupmanagement.html" class="navbar-item">Manage Groups</a></li>
        </ul>
    </nav>

	<h1>Simple Search</h1>

	<h2>Search for users and groups</h2>

	<!-- ========== USER SEARCH ========== -->
	<label for="usernameInput">Username (optional):</label>
	<input id="usernameInput" type="text" placeholder="Enter username">
	<br><br>

	<button id="searchAllUsersButton">Search ALL Users</button>
	<button id="searchUserByNameButton">Search by Username</button>

	<div id="userMessage"></div>

	<table>
		<thead>
			<tr>
				<th>User ID</th>
				<th>Name</th>
				<th>Age</th>
				<th>Budget</th>
			</tr>
		</thead>
		<tbody id="users"></tbody>
	</table>

	<p></p>

	<!-- ========== GROUP SEARCH ========== -->
	<label for="groupNameInput">Group name (optional):</label>
	<input id="groupNameInput" type="text" placeholder="Enter group name">
	<br><br>

	<button id="searchAllGroupsButton">Search ALL Groups</button>
	<button id="searchGroupByNameButton">Search by Group Name</button>

	<div id="clubMessage"></div>

	<table>
		<thead>
			<tr>
				<th>Group ID</th>
				<th>Group Name</th>
				<th>Age Limit</th>
				<th>Budget</th>
			</tr>
		</thead>
		<tbody id="bookclub"></tbody>
	</table>

	<p></p>

	<script>
    // Generic fetch + render helper
    function fetchAndDisplayData(tableId, messageId, url) {
        let table = document.getElementById(tableId);
        let message = document.getElementById(messageId);

        table.textContent = '';
        message.textContent = '';

        fetch(url)
            .then((response) => response.json())
            .then((body) => {
                console.log(body);
                if (!body.rows || body.rows.length === 0) {
                    message.textContent = "No data found";
                    return;
                }

                for (let item of body.rows) {
                    let row = document.createElement("tr");
                    for (let key of Object.keys(item)) {
                        let col = document.createElement("td");

                        if (item[key] === true) {
                            col.textContent = "Yes";
                        } else if (item[key] === false) {
                            col.textContent = "No";
                        } else {
                            col.textContent = item[key];
                        }
                        row.appendChild(col);
                    }
                    table.appendChild(row);
                }
            })
            .catch((error) => {
                console.error(error);
                message.textContent = "An error occurred while fetching data.";
            });
    }

    // ðŸ”¹ USERS: search all
    document.getElementById("searchAllUsersButton").addEventListener("click", () => {
        fetchAndDisplayData("users", "userMessage", "/search?table=users");
    });

    // ðŸ”¹ USERS: search by username
    document.getElementById("searchUserByNameButton").addEventListener("click", () => {
        const usernameInput = document.getElementById("usernameInput");
        const username = usernameInput.value.trim();
        const message = document.getElementById("userMessage");
        const table = document.getElementById("users");

        table.textContent = '';
        message.textContent = '';

        if (username === "") {
            message.textContent = "Please enter a username.";
            return;
        }

        const url = `/search?table=users&name=${encodeURIComponent(username)}`;
        fetchAndDisplayData("users", "userMessage", url);
    });

    // ðŸ”¹ GROUPS: search all
    document.getElementById("searchAllGroupsButton").addEventListener("click", () => {
        fetchAndDisplayData("bookclub", "clubMessage", "/search?table=clubs");
    });

    // ðŸ”¹ GROUPS: search by group name
    document.getElementById("searchGroupByNameButton").addEventListener("click", () => {
        const groupNameInput = document.getElementById("groupNameInput");
        const groupName = groupNameInput.value.trim();
        const message = document.getElementById("clubMessage");
        const table = document.getElementById("bookclub");

        table.textContent = '';
        message.textContent = '';

        if (groupName === "") {
            message.textContent = "Please enter a group name.";
            return;
        }

        const url = `/search?table=clubs&groupName=${encodeURIComponent(groupName)}`;
        fetchAndDisplayData("bookclub", "clubMessage", url);
    });
	</script>

</body>
</html>

